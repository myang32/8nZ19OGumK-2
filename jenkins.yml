- name: Install jenkins
  hosts: localhost
  vars:
    jenkins_hostname: localhost
   
  tasks:
    - name: Install git jenkins plugins
      jenkins_plugin: 
        name: git
        state: present
        with_dependencies: yes

    - name: Install ansible jenkins plugins
      jenkins_plugin: 
        name: ansible
        state: present
        with_dependencies: yes
    
    - name: Install terraform jenkins plugins
      jenkins_plugin: 
        name: terraform
        state: present
        with_dependencies: yes

    - name: Install blueocean jenkins plugins
      jenkins_plugin: 
        name: blueocean
        state: present
        with_dependencies: yes

    - name: Restart jenkins service, Wait untils Jenkins web API is available
      shell: curl --head --silent http://localhost:8080/cli/
      register: result
      until: result.stdout.find("200 OK") != -1
      retries: 12
      delay: 5

  roles:
    - role: geerlingguy.jenkins
      become: yes
